<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Inquiry</title>
  <style>
    .header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; }
    input[type="text"] { width: 100%; padding: 14px 16px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; }
    .search-box { display: flex; gap: 8px; margin-bottom: 16px; }
    .search-box input { flex: 1; }
    .search-box button { padding: 0 20px; font-size: 16px; border: 1px solid #2563eb; background: #2563eb; color: white; border-radius: 6px; cursor: pointer; }
    .search-box button:hover { background: #1e4fd8; }
    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .col-desc { width: 50%; } .col-mlfb { width: 30%; } .col-status  { width: 20%; }
    th { background: #f5f7fa; font-weight: 600; text-align: left; padding: 12px; border-bottom: 2px solid #ddd; }
    td { padding: 10px 12px; border-bottom: 1px solid #eee; word-break: break-all; }
    td.desc { max-width: 600px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
    td.desc.expanded { white-space: normal; }
    .logo { height: 100px; object-fit: contain; margin-top: 20px; }  
    #pagination { margin-top: 20px; text-align: center; }
    #pagination button { padding: 6px 12px; border: 1px solid #ccc; background: white; cursor: pointer; border-radius: 4px; margin: 0 2px; }
    #pagination button.active { background: #2c7be5; color: white; font-weight: bold; border-color: #2c7be5; }
    #pagination button:disabled { cursor: default; opacity: 0.5; }
    #result-info { margin-top: 12px; font-size: 14px; color: #555; text-align: right; }
    mark { background-color: #fff3a0; padding: 0 2px; }
    .status-A { color: #16a34a; font-weight: 600; cursor: pointer; }
    .status-B { color: #f59e0b; font-weight: 600; cursor: pointer; }
    .status-C { color: #6b7280; font-weight: 600; cursor: pointer; }
    #contactModal, #priceModal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal-content { background: white; padding: 24px; border-radius: 10px; width: 320px; text-align: center; }
    .modal-content button { margin-top: 16px; padding: 8px 16px; border: none; background: #2563eb; color: white; border-radius: 6px; cursor: pointer; }
    .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .contact-link { text-decoration: underline; cursor: pointer; font-weight: 600; color: #2563eb; }
    .mlfb-link { color: #2563eb; text-decoration: underline; cursor: pointer; font-weight: 500; }
    .special-tag { color: #dc2626; font-weight: 700; margin-right: 6px; cursor: pointer; font-size: 13px; }
    .mobile-list { display: none; }

    @media (max-width: 768px) {
      body { margin: 16px; }
      .header { flex-direction: column; align-items: flex-start; gap: 8px; }
      .logo { height: 60px; margin-top: 0; }
      table { display: none !important; }
      .mobile-list { display: flex; flex-direction: column; gap: 12px; }
      .mobile-card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px; background: #fff; }
      .mobile-desc-title { font-size: 15px; font-weight: 600; margin-bottom: 6px; cursor: pointer; }
      .mobile-desc-content { display: none; font-size: 14px; line-height: 1.5; margin-bottom: 10px; }
      .mobile-card.open .mobile-desc-content { display: block; }
    }

  .empty-box {
    padding: 40px 20px;
    text-align: center;
    border-radius: 8px;
    margin-top: 20px;
  }

  .empty-box.guide {
    color: #777;
    font-size: 14px;
  }

  .empty-box.no-result {
    background: #fff5f5;
    color: #d33;
    font-size: 16px;
    font-weight: 600;
    border: 1px solid #ffd6d6;
  }


  </style>
</head>
<body>

<div class="header">
  <h2>ì„œì˜¤ ì¬ê³  ì¡°íšŒ</h2>
  <img src="company_logo_v2.jpg" alt="company Logo" class="logo">
</div>
<p>ì°¾ìœ¼ì‹œëŠ” ì œí’ˆ [ ex) CPU, 1515... ] ë˜ëŠ” MLFBë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>

<div class="search-box">
  <input type="text" id="search" placeholder="ì˜ˆë¥¼ë“¤ì–´ CPU, 1515, 6ES7...">
  <button id="searchBtn" type="button">ê²€ìƒ‰</button>
</div>

<p style="font-size:13px;color:#777;margin-bottom:12px;">
  â€» ì•ˆë‚´: ë³¸ ì •ë³´ëŠ” ì‹¤ì œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë©°, ìì„¸í•œ ì‚¬í•­ì€ 
  <span class="contact-link" onclick="openModal()">ë¬¸ì˜</span> ë°”ëë‹ˆë‹¤.
</p>

<div id="contactModal">
  <div class="modal-content">
    <h3>ë¬¸ì˜ ì•ˆë‚´</h3>
    <p>ì•„ë˜ ì—°ë½ì²˜ë¡œ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.</p>
    <p>
      ğŸ“ <a href="tel:0552554360" style="font-weight:600; color:#000; text-decoration:none;">055-255-4360</a><br><br>
      âœ‰ï¸ <a href="http://pf.kakao.com/_AtwAX" target="_blank" style="color:#2563eb; font-weight:600; text-decoration:none;">ì¹´ì¹´ì˜¤í†¡ ì±„ë„ "ì£¼ì‹íšŒì‚¬ ì„œì˜¤"</a><br>
      <a href="http://pf.kakao.com/_AtwAX/chat" target="_blank" style="font-size:14px; color:#555; text-decoration:underline;">(ì±„íŒ…ë¬¸ì˜ ë°”ë¡œê°€ê¸° "click")</a>
    </p>
    <button onclick="closeModal()">ë‹«ê¸°</button>
  </div>
</div>

<div id="priceModal">
  <div class="modal-content">
    <h3>íŠ¹ê°€ ì•ˆë‚´</h3>
    <p id="price-display" style="font-size:18px;font-weight:700; color:#dc2626;"></p>
    <button onclick="closePriceModal()">ë‹«ê¸°</button>
  </div>
</div>

<div class="info-row">
  <div id="update-info" style="font-size:13px;color:#666;">ë°ì´í„° ê¸°ì¤€ì¼: -</div>

  <label style="font-size:13px; cursor:pointer;">
    <input type="checkbox" id="onlySpecial" />
    íŠ¹ê°€ ì œí’ˆë§Œ ë³´ê¸°
  </label>

  <div class="sort-box">
    <select id="sortSelect">
      <option value="">ì •ë ¬ ì—†ìŒ</option>
      <option value="mlfb">MLFB ì˜¤ë¦„ì°¨ìˆœ</option>
      <option value="status">ì¬ê³  ìƒíƒœ ìš°ì„ </option>
    </select>
  </div>



</div>

<table>
  <thead>
    <tr>
      <th class="col-desc">Description</th>
      <th class="col-mlfb">MLFB</th>
      <th class="col-status">ì¬ê³  ìƒíƒœ</th>
    </tr>
  </thead>
  <tbody id="table-body"></tbody>
</table>

<div id="emptyMessage" class="empty-box"></div>

<div id="result-info"></div>
<div id="pagination"></div>
<div id="mobile-list" class="mobile-list"></div>

<script>
let allRows = [];        
let filteredRows = [];   
let searchKeyword = "";  
const rowsPerPage = 30;  
let currentPage = 1;     

// CSVë¥¼ ì •í™•í•˜ê²Œ ë¶„ë¦¬í•˜ëŠ” í•¨ìˆ˜ (ë”°ì˜´í‘œ ë‚´ ì‰¼í‘œ ë¬´ì‹œ)
function parseCSVLine(line) {
    const result = [];
    let cur = "";
    let inQuotes = false;
    for (let i = 0; i < line.length; i++) {
        let char = line[i];
        if (char === '"') {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            result.push(cur.trim());
            cur = "";
        } else {
            cur += char;
        }
    }
    result.push(cur.trim());
    return result;
}

fetch("stock.csv?v=20260130")
  .then(res => res.text())
  .then(text => {
    const lines = text.trim().split(/\r?\n/);
    let baseDate = "-";
    
    if (lines[0] && lines[0].includes("#DATE=")) {
      const match = lines[0].match(/#DATE=([^",\r\n]+)/);
      if (match) baseDate = match[1].trim();
      lines.shift();
    }
    document.getElementById("update-info").textContent = `ë°ì´í„° ê¸°ì¤€ì¼: ${baseDate}`;

    // í—¤ë” ì¤„ ì œì™¸ í›„ ë°ì´í„° ê°€ê³µ
    const dataLines = lines.filter(line => line.trim() !== "").slice(1);
    allRows = dataLines.map(line => {
      const cleanCols = parseCSVLine(line);
      if (cleanCols.length < 2) return null;
      return {
        desc: cleanCols[0] || "",
        part: cleanCols[1] || "",
        status: (cleanCols[2] || "").toUpperCase(),
        price: cleanCols[3] || ""
      };
    }).filter(row => row && row.part);

    filteredRows = [];
    updateView();
  });

function updateView() {
  renderTable();
  renderPagination();
  renderResultInfo();
  renderMobileList();
}

function renderTable() {
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";
  if (filteredRows.length === 0) return;

  const start = (currentPage - 1) * rowsPerPage;
  const pageRows = filteredRows.slice(start, start + rowsPerPage);

  pageRows.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="desc" onclick="toggleDesc(this)">
        ${row.price ? `<span class="special-tag" onclick="openPriceModal('${row.price}'); event.stopPropagation();">ğŸ”¥ íŠ¹ê°€</span>` : ''}
        ${highlight(row.desc)}
      </td>
      <td><span class="mlfb-link" onclick="copyMLFB('${row.part}')">${highlight(row.part)}</span></td>
      <td class="status-${row.status}" onclick="openModal()">${statusText(row.status)}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderMobileList() {
  const container = document.getElementById("mobile-list");
  container.innerHTML = "";
  if (filteredRows.length === 0) return;

  const start = (currentPage - 1) * rowsPerPage;
  const pageRows = filteredRows.slice(start, start + rowsPerPage);

  pageRows.forEach(row => {
    const div = document.createElement("div");
    div.className = "mobile-card";
    const shortDesc = row.desc.length > 40 ? row.desc.slice(0, 40) + "..." : row.desc;
    div.innerHTML = `
      <div class="mobile-desc-title" onclick="toggleMobileDesc(this)">
        ${row.price ? `<span class="special-tag" onclick="openPriceModal('${row.price}'); event.stopPropagation();">ğŸ”¥ íŠ¹ê°€</span>` : ''}
        ${highlight(shortDesc)}
      </div>
      <div class="mobile-desc-content">${highlight(row.desc)}</div>
      <div class="mobile-mlfb" onclick="copyMLFB('${row.part}')">${highlight(row.part)}</div>
      <div class="mobile-status status-${row.status}" onclick="openModal()">${statusText(row.status)}</div>
    `;
    container.appendChild(div);
  });
}

function renderPagination() {
  const container = document.getElementById("pagination");
  container.innerHTML = "";
  if (filteredRows.length === 0) return;

  const pageCount = Math.ceil(filteredRows.length / rowsPerPage);
  
  const firstBtn = document.createElement("button");
  firstBtn.textContent = "<< ì²˜ìŒ";
  firstBtn.disabled = currentPage === 1;
  firstBtn.onclick = () => { currentPage = 1; updateView(); };
  container.appendChild(firstBtn);

  const prevBtn = document.createElement("button");
  prevBtn.textContent = "< ì´ì „";
  prevBtn.disabled = currentPage === 1;
  prevBtn.onclick = () => { currentPage--; updateView(); };
  container.appendChild(prevBtn);

  let start = Math.max(1, currentPage - 2);
  let end = Math.min(pageCount, start + 4);
  if (end - start < 4) start = Math.max(1, end - 4);

  for (let i = start; i <= end; i++) {
    if (i < 1) continue;
    const btn = document.createElement("button");
    btn.textContent = i;
    if (i === currentPage) btn.classList.add("active");
    btn.onclick = () => { currentPage = i; updateView(); };
    container.appendChild(btn);
  }

  const nextBtn = document.createElement("button");
  nextBtn.textContent = "ë‹¤ìŒ >";
  nextBtn.disabled = currentPage === pageCount;
  nextBtn.onclick = () => { currentPage++; updateView(); };
  container.appendChild(nextBtn);

  const lastBtn = document.createElement("button");
  lastBtn.textContent = "ë >>";
  lastBtn.disabled = currentPage === pageCount;
  lastBtn.onclick = () => { currentPage = pageCount; updateView(); };
  container.appendChild(lastBtn);
}

document.getElementById("searchBtn").addEventListener("click", () => {
  const value = document.getElementById("search").value.trim().toLowerCase();
  searchKeyword = value;
  if (value.length < 2) { alert("ê²€ìƒ‰ì–´ëŠ” 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
  const statusPriority = { A: 3, B: 2, C: 1 };
  const map = new Map();

  allRows.forEach(row => {
    if (
      normalize(row.desc).includes(normalize(value)) ||
      normalize(row.part).includes(normalize(value))
    ) {
      const key = row.part;

      if (!map.has(key)) {
        map.set(key, row);
      } else {
        const existing = map.get(key);
        if (statusPriority[row.status] > statusPriority[existing.status]) {
          map.set(key, row);
        }
      }
    }
  });

  filteredRows = Array.from(map.values());

  // íŠ¹ê°€ë§Œ ë³´ê¸° ì²´í¬ ì‹œ í•„í„°ë§
  const onlySpecial = document.getElementById("onlySpecial").checked;
  if (onlySpecial) {
    filteredRows = filteredRows.filter(row => row.price);
  }

  currentPage = 1;
  applySort();
  updateView();
});

document.getElementById("search").addEventListener("keydown", (e) => { if (e.key === "Enter") document.getElementById("searchBtn").click(); });
document.getElementById("sortSelect").addEventListener("change", () => { applySort(); currentPage = 1; updateView(); });

function applySort() {
  const sortType = document.getElementById("sortSelect").value;
  if (sortType === "mlfb") filteredRows.sort((a, b) => a.part.localeCompare(b.part));
  else if (sortType === "status") {
    const order = { A: 1, B: 2, C: 3 };
    filteredRows.sort((a, b) => (order[a.status] || 9) - (order[b.status] || 9));
  }
}

function renderResultInfo() {
    const info = document.getElementById("result-info");
    const emptyBox = document.getElementById("emptyMessage");

    // ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
    if (filteredRows.length === 0) {

      info.textContent = ""; // ê¸°ì¡´ í…ìŠ¤íŠ¸ ì œê±°
      emptyBox.style.display = "block";

      if (!searchKeyword) {
        emptyBox.className = "empty-box guide";
        emptyBox.innerHTML = "ğŸ” ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      } else {
        emptyBox.className = "empty-box no-result";
        emptyBox.innerHTML = `
          â— ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
          <span style="font-size:13px;font-weight:400;">
            ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
          </span>
        `;
      }

      return;
    }

    // ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš°
    emptyBox.style.display = "none";
    info.textContent = `ì´ ${filteredRows.length}ê±´ ê²€ìƒ‰ë¨ (${currentPage}í˜ì´ì§€)`;
  }

function highlight(text) { if (!searchKeyword) return text; const regex = new RegExp(`(${searchKeyword})`, "gi"); return text.replace(regex, "<mark>$1</mark>"); }
function normalize(text) { return text.toLowerCase().replace(/[\s-]/g, ""); }
function statusText(code) { const texts = { "A": "ì¦‰ì‹œ ì¶œê³  ê°€ëŠ¥", "B": "ì¬ê³  ë³´ìœ (ë¬¸ì˜)", "C": "í™•ì¸ í•„ìš”(ë¬¸ì˜)" }; return texts[code] || "-"; }
function toggleDesc(td) { td.classList.toggle("expanded"); }
function toggleMobileDesc(el) { el.parentElement.classList.toggle("open"); }
function copyMLFB(text) { navigator.clipboard.writeText(text); alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: " + text); }
function openModal() { document.getElementById("contactModal").style.display = "flex"; }
function closeModal() { document.getElementById("contactModal").style.display = "none"; }
function openPriceModal(price) {
  const cleanPrice = price.toString().replace(/[^0-9]/g, '');
  document.getElementById("price-display").textContent = `ğŸ’° ${Number(cleanPrice).toLocaleString()} ì›`;
  document.getElementById("priceModal").style.display = "flex";
}
function closePriceModal() { document.getElementById("priceModal").style.display = "none"; }
window.onclick = function(event) { if (event.target.id === "contactModal" || event.target.id === "priceModal") { closeModal(); closePriceModal(); } }

const statusPriority = { 'A': 1, 'B': 2, 'C': 3 };

document.getElementById("onlySpecial").addEventListener("change", () => {
  document.getElementById("searchBtn").click();
});




</script>
</body>
</html>